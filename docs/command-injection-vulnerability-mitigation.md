# 命令注入漏洞和缓解

> 原文:[https://www . geesforgeks . org/command-injection-漏洞-缓解/](https://www.geeksforgeeks.org/command-injection-vulnerability-mitigation/)

命令注入基本上是通过 web 应用程序注入要执行的操作系统命令。命令注入攻击的目的是在易受攻击的应用程序中注入并执行攻击者指定的命令。在这种情况下，执行不需要的系统命令的应用程序就像一个伪系统外壳，攻击者可以将其用作任何授权的系统用户。但是，命令的执行权限和环境与 web 应用程序相同。命令注入攻击是可能的，因为缺乏正确的输入数据验证，这可能被攻击者操纵(表单、cookies、HTTP 头等)。).

有一个变种的[代码注入攻击](https://en.wikipedia.org/wiki/Code_injection)。在代码注入中，攻击者将自己的代码添加到现有代码中。注入的代码以与应用程序相同的权限和环境执行。

当攻击者试图通过易受攻击的应用程序执行系统级命令时，就会发生操作系统命令注入攻击。如果应用程序在系统级命令中利用用户输入，则被认为容易受到操作系统命令注入攻击。

示例:

```cpp
// C program to demonstrate Command Injection attack
// The purpose of the program to print contents of a
// file provided as command line argument.
#include <stdio.h>
#include <unistd.h>

int main(int argc, char **argv)
{
    char cat[] = "cat ";
    char *command;
    size_t commandLength;

    commandLength = strlen(cat) + strlen(argv[1]) + 1;
    command = (char *) malloc(commandLength);
    strncpy(command, cat, commandLength);
    strncat(command, argv[1], (commandLength - strlen(cat)) );

    system(command);
    return (0);
}
```

正常使用时，输出只是请求文件的内容:

```cpp
$ ./a.out exploit.txt
my name is akash

```

**然而，如果我们在这一行的末尾添加一个分号和另一个命令，该命令将由 catWrapper 毫无怨言地执行:**

```cpp
$ ./a.out "exploit.txt; ls"
my name is akash
exploit.txt               doubFree.c              nullpointer.c
unstosig.c              www*                    a.out*
format.c                strlen.c                useFree*
catWrapper*             misnull.c               strlength.c             useFree.c
commandinjection.c      nodefault.c             trunc.c                 writeWhatWhere.c

```

以下 PHP 代码片段容易受到命令注入攻击(web 应用程序):

```cpp
<?php
print("Please specify the name of the file to delete");
print("<p>");
$file=$_GET['filename'];
system("rm $file");
?>
```

以下请求和响应是成功攻击的示例:

```cpp
Request
http://mywesite.com/delete.php?filename=bob.txt;id

```

```cpp
Response
Please specify the name of the file to delete
uid=33(www-data) gid=33(www-data) groups=33(www-data) 

```

**缓解**

*   理想情况下，开发人员应该将现有的应用编程接口用于他们的语言。例如(Java):与其使用 Runtime.exec()发出“mail”命令，不如使用位于 javax.mail. *的可用 Java API
*   如果不存在这样的应用编程接口，开发人员应该清除所有输入中的恶意字符。实施一个积极的安全模式将是最有效的。通常，定义合法字符比定义非法字符容易得多。

**参考资料**
[https://en.wikipedia.org/wiki/Code_injection](https://en.wikipedia.org/wiki/Code_injection)
[http://stackoverflow . com/questions/44799/preventing-命令行-注入-攻击](http://stackoverflow.com/questions/44799/preventing-command-line-injection-attacks)

本文由**阿卡什·莎兰**供稿。如果你喜欢 GeeksforGeeks 并想投稿，你也可以使用[contribute.geeksforgeeks.org](http://www.contribute.geeksforgeeks.org)写一篇文章或者把你的文章邮寄到 contribute@geeksforgeeks.org。看到你的文章出现在极客博客主页上，帮助其他极客。

如果你发现任何不正确的地方，或者你想分享更多关于上面讨论的话题的信息，请写评论。